<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Drug List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-QC0/KM9tJvApoT3KM7GzFZn3ZtMz1+d6H4YY6b4dWm9gJvqLMbSJoCkTcN6kkzTl" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

	<!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/css/bootstrap.min.css">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.min.css">
  <style>
  input[type=text] {
      border: 0;

    }

    input[type=text]:focus {
      border: 0;
    }

    h4 {
      font-size: 1.4rem;
      text-align: center;
    }

    .w3-green {
      background: #1977cc;
      border: 0;
      padding: 8px 24px;
      color: #fff;
      transition: 0.4s;
      border-radius: 5px;
    }

    .w3-red {
      background: #1977cc;
      border: 0;
      padding: 8px 24px;
      color: #fff;
      transition: 0.4s;
      border-radius: 5px;
    }
  /* Include the padding and border in an element's total width and height */
    * {
      box-sizing: border-box;
    }

    #myhomepage {
      padding-top: 75px;
      padding-right: 100px;
    }

    /* Remove margins and padding from the list */
    #myUL {
      margin: 10px 10%;
      padding: 0;
      margin-bottom: 0;
    }

    /* Style the list items */
    #myUL > li {
      cursor: pointer;
      position: relative;
      top: 10px;
      padding: 20px 8px 4px 10px;
      text-align: center;
      background: #e5ecdde1;
      font-size: 18px;
      transition: 0.2s;

      /* make the list items unselectable */
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* Set all odd list items to a different color (zebra-stripes) */
    #myUL > li:nth-child(odd) {
      background: #f9f9f9;
    }

    /* Darker background-color on hover */
    #myUL > li:hover {
      background: #ddd;
    }

    /* When clicked on, add a background color and strike out text */
    #myUL > li.checked {
      background: #888;
      color: #fff;
      text-decoration: line-through;
    }

    #myhomepage {
      margin-left: 250px;
      transition: all 0.3s ease-in-out;
    }

    /* Define the main content's position when the sidebar is active */
    #myhomepage.active {
      margin-left: 0;
    }
    .tag-container {
      display: flex;
      padding: 30px;
    }

    /* Style the close button */
    .close {
      position: absolute;
      right: 0;
      top: 0;
      padding: 12px 16px 12px 16px;
      background-color: #2b1e1e;
      color: white;
    }

    .close:hover {
      background-color: #643d3d;
      color: white;
    }

    /* Style the header */
    .header {
      background-color: #fff;
      padding: 10px 40px;
      margin-bottom: 30 !important;
      color: white;
      text-align: center;
    }

    /* Clear floats after the header */
    .header:after {
      content: "";
      display: table;
      clear: both;
    }

  .footer {
    width: 100%;
    height: 50px;
    line-height: 60px;
  }

    .myheading {
  color: #0c0c0f;
  font-family: Helvetica, "Open Sans", Arial, sans-serif;
  font-size: 32px;
  font-weight: bold;
  background-image: linear-gradient(to right, #004C99, #ff6666);

  display: flex;
  font-size: 32px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  width: 300px;
  text-align: center;
  margin: auto;
  white-space: nowrap;
  padding-bottom: 50px;
  padding-top: 20px;
  background-clip: text;
  color: transparent;
  -webkit-background-clip: text;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.myheading:before,
.myheading:after {
  background-color: #064c02;
  content: "";
  display: block;
  height: 3px;
  width: 275px;
  margin-bottom: 5px;
}

.myheading:before {
  background-color: #046e18;
}

.myheading:after {
  margin-top: 5px;
}
#myInput {
  position: relative;
  margin: 0 auto;
  margin-bottom: 3px;
  margin-left: 40px;
  border: solid 3px black;
  border-radius: 5px;
  width: 50%;
  padding: 10px;
  float: center;
  font-size: 16px;
}

.myInput {
  flex: 1;
  display: inline-block;
  margin: 0 auto;
  margin-bottom: 3px;
  margin-left: 85px;
  border: solid 3px black;
  border-radius: 10px;
  width: 50%;
  padding: 10px;
  float: center;
  font-size: 16px;
}
.addBtn {
  padding: 10px;
  display: inline-block;
  width: 10%;
  background: #d9d9d9;
  vertical-align: middle;
  color: #170411;
  float: center;
  text-align: center;
  font-size: 18px;
  cursor: pointer;
  transition: 0.3s;
  border-radius: 5px;
  margin-left: 10px;
  margin-right: 10px;
}

.submitBtn {
  padding: 10px;
  display: inline-block;
  width: 5%;
  background: #128216;
  vertical-align: middle;
  color: white;
  float: center;
  text-align: center;
  font-size: 18px;
  cursor: pointer;
  transition: 0.3s;
  border-radius: 5px;
  margin-left: 10px;
  margin-right: 10px;
}

@media only screen and (max-width: 768px) {
  .addBtn {
    width: 30%;
  }
}

@media only screen and (max-width: 576px) {
  .addBtn {
    width: 50%;
  }
}

.addBtn:hover {
  background-color: #bedcf7;
}

@media only screen and (max-width: 768px) {
  .submitBtn {
    width: 30%;
  }
}

@media only screen and (max-width: 576px) {
  .submitBtn {
    width: 50%;
  }
}

.submitBtn:hover {
  background-color: #0fb015;
}
#mybtn {
      content: "";
      position: relative;
      bottom: 0px;
      clear: both;
      display: block;
      margin: 40px auto;
      width: 20%;
      text-align: center;
    }

    #mybtn > button {
      background-color: #128216;
      /* Green */
      border: none;
      color: white;
      padding: 15px 26px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
    }

    /* #mybtn:hover {
      background-color: #61c864;
    } */

    #drugtable {
  font-family: Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 80%;
  margin: auto;
  max-width: 800px;
  table-layout: fixed;
}

#drugtable td,
#drugtable th {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}

#drugtable tr:nth-child(even) {
  background-color: #f2f2f2;
}

#drugtable tr:hover {
  background-color: #999999;
}

#drugtable > th {
  padding-top: 12px;
  padding-bottom: 12px;
    background-color: #00CC99;
  color: #fff;
  text-align: center;
}

#drugtable th:first-child,
#drugtable td:first-child {
  text-align: center;
}

@media only screen and (max-width: 600px) {
  #drugtable {
    width: 100%;
    margin-left: 0;
    margin-right: 0;
  }
}


    #notediv {
      padding-left: 10px;
      margin-top: 20px;
      margin-bottom: 20px;
      font-size: 20px;
      color: #ff0000;
      text-align: center;
      display:none;
    }

    #interactiondiv {
      padding-left: 125px;
      font-size: 30px;
      color: #000000;
      text-align: center;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
    }

    #mydiv {
      color: #6a6969;
    }

    #loadingdiv {
      margin-top: 20px;
      font-size: 20px;
      color: #5a5a5a;
      text-align: center;
    }
/* Style the tags */
#tag-section {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  margin-top: 20px;
  margin-bottom: 10px;
}

.tag {
  display: inline-block;
  background-color: #bedcf7;
  color: #170411;
  padding: 3px 10px;
  margin-right: 10px;
  border-radius: 5px;
  font-size: 16px;
  margin-top: 3px;
  width: fit-content;
}

.tag button {
  margin-left: 5px;
  background-color: #424242;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 16px;
}

.tag button:hover {
  background-color: #232222;
}

#dropdown {
      margin: 0;
      margin-bottom: 35px;
      border: solid 3px black;
      border-radius: 10px;
      width: 100%;
      padding: 10px;
      float: center;
    }

    #dropdown-input {
      margin: 0;
      margin-bottom: 35px;
      border: solid 3px black;
      border-radius: 10px;
      width: 100%;
      padding: 10px;
      float: left;
      font-size: 16px;
    }

    .dropdown-list {
    	display: none;
      position: absolute;
            top: 100%;
            left: 25%;
      right: 0.5px;
      z-index: 1;
      width: 50.5%;
      height: 200px;
      overflow-y: auto;
      background-color: #fff;
      border: 1px solid #0e0e0e;
      border-radius: 4px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    }

    .dropdown-list-item {
      padding: 10px;
      cursor: pointer;
      color:#0c0c0f
    }

    .dropdown-list-item:hover {
      background-color: #d0d3d3;
    }

/* Animation for error label */
@keyframes slide-down {
  0% {
    transform: translateY(-100%);
  }
  100% {
    transform: translateY(0);
  }
}

@keyframes slide-up {
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-100%);
  }
}

.alert.slide-down {
  animation: slide-down 0.5s ease-out forwards;
}

.alert.slide-up {
  animation: slide-up 0.5s ease-out forwards;
}

.back-to-top {
  position: absolute;
  bottom: 0;
  right: 0;
  margin-bottom: 0px;
  margin-right: 20px;
}

  </style>

</head>


<script>
  document.addEventListener("DOMContentLoaded", function (event) {
    console.log('DOM content loaded');
    var scrollpos = localStorage.getItem('scrollpos');
    if (scrollpos) window.scrollTo(0, scrollpos);
  });

  //window.onbeforeunload = function (e) {
  //  localStorage.setItem('scrollpos', window.scrollY);
  //};
</script>

<script>
  window.tagsList = [];
  console.log('initial value', window.tagsList);

  document.getElementById("myUL").innerHTML= "";
  const INTERACTION_EXAMPLE = [
  {id: 1, name: "Aluminum hydroxide"},
  {id: 2, name: "Dolutegravir"},
  {id: 3, name: "Aprepitant"},
  {id: 4, name: "Abacavir"},
  {id: 5, name: "Orlistat"},
  {id: 6, name: "Dexamethasone"},
]
// Create a "close" button and append it to each list item
var myNodelist = document.getElementById("myUL").childNodes; // Yaha bhi hein ek LI
for (var i = 0; i < myNodelist.length; i++) {
  myNodelist[i].parentNode.removeChild(myNodelist[i]);
}
var i;
for (i = 0; i < myNodelist.length; i++) {
  var span = document.createElement("SPAN");
  var txt = document.createTextNode("\u00D7");
  span.className = "close";
  span.appendChild(txt);
  myNodelist[i].appendChild(span);
}

// Click on a close button to hide the current list item
var close = document.getElementsByClassName("close");
var i;
for (i = 0; i < close.length; i++) {
  close[i].onclick = function () {
    var div = this.parentElement;
    console.log("Close button click hua!");
    div.style.display = "none";
  }
}

function showError(message) {
  const errorLabel = document.getElementById("error-label");
  errorLabel.innerText = message;
  errorLabel.classList.remove("d-none");
  errorLabel.classList.add("animate__animated", "animate__fadeIn");
}

function hideError() {
  const errorLabel = document.getElementById("error-label");
  errorLabel.innerText = "";
  errorLabel.classList.add("d-none");
  errorLabel.classList.remove("animate__animated", "animate__fadeIn");
}


function newElement() {
  const ul = document.getElementById("myUL");
  ul.innerHTML = ""; // clear the existing list items
	if (window.tagsList.length == 0) {
		showError("Please add at least one drug tag before confirmation!");
	}
	else {
		hideError();  // Hide error if any
	  for (let i = 0; i < window.tagsList.length; i++) {
		const li = document.createElement("li");
		const t = document.createTextNode(window.tagsList[i]);
		li.appendChild(t);

		const span = document.createElement("button");
		const txt = document.createTextNode("X");
		span.className = "close btn btn-sm";
		span.setAttribute("type", "button");
		span.appendChild(txt);
		li.appendChild(span);

		ul.appendChild(li);

		// add delete functionality
		span.addEventListener("click", function () {
		  const li = this.parentElement;
		  ul.removeChild(li);
		});
	  }
	  console.log('tagslist inside new element', window.tagsList)
	}
}


function reset() {
    document.getElementById("myUL").innerHTML = "";
    var table = document.getElementById("drugtable");
    table.innerHTML = "";
    var tagSection = document.getElementById("tag-section");
    tagSection.innerHTML = ""; // delete all the tag elements
    window.tagsList.length = 0; // reset the tagsList array
    deleteNote();
}

function showDropdown() {
  console.log("dropdown called");
  const dropdown = document.querySelector('.dropdown-list');
  dropdown.classList.toggle('show');
}

function deleteList() {
  document.getElementById("myUL").innerHTML= "";
}

function deleteTable(){
  var table = document.getElementById("drugtable");
  table.innerHTML = "";
}

function addLoading() {
  var loadingdiv = document.getElementById("loadingdiv");
  loadingdiv.innerHTML = "<b> Loading... </b>"
}

function deleteLoading() {
  var loadingdiv = document.getElementById("loadingdiv");
  loadingdiv.innerHTML = ""
}

function updateTable(interactions) {
  deleteTable();
  deleteNote();
  if (interactions.length > 0) {
  	hideError();  // Hide error if any
    var mytable = document.getElementById("drugtable");

    var header = mytable.createTHead();
    header.classList.add("text-white"); // add text-white class to thead
    var row = header.insertRow(0);
    row.style.backgroundColor = "black";
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    cell1.innerHTML = "<b>Drug1</b>";
    cell2.innerHTML = "<b>Drug2</b>";
    cell3.innerHTML = "<b>Level</b>";

    colorList = { "Major": "#904d35", "Moderate": "#9e9236", "Minor": "#409e56", "Unknown": "#6a6969" };

    var ind = 1;
    interactions.map(interaction => {
      var row = mytable.insertRow(ind++)
      row.style.backgroundColor = colorList[interaction["severity"]]

      var cell1 = row.insertCell(0)
      var cell2 = row.insertCell(1)
      var cell3 = row.insertCell(2)
      cell1.innerHTML = interaction["drug1"];
      cell2.innerHTML = interaction["drug2"];
      cell3.innerHTML = interaction["severity"]
    });
    deleteList();
  }
  else {
    // Display HTML message for no interactions
    deleteList();
    // alert("No interactions found!");
    showError("No interactions found!");
  }

  // deleteLoading();
}

function addNote(count) {
  // console.log(count);
  if (count["Unknown"] > 0) {
    var notediv = document.getElementById("notediv");
    notediv.style.display = "block";
    notediv.innerHTML = "*Note: <b>Unknown interaction means there might be an interaction between the drugs but with unknown severity.</b>"
  }
}

function deleteNote() {
  var notediv = document.getElementById("notediv");
  notediv.innerHTML = "";
  notediv.style.display = "none";
}


function fetchData() {
  console.log("Fetched Data");
    fetch('/getDrugsList')
      .then(response => response.json())
      .then(data => {
        window.drugsList = data;  // Declare the variable as global
        console.log('inside', window.drugsList);

        // Creating a swapped drugsList
        window.swappedDrugsList = {};
        for (const key in window.drugsList) {
          const value = window.drugsList[key];
          window.swappedDrugsList[value] = key;
        }
        initDropdown();
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
}

function checkFetch() {
  const dropdown = document.querySelector('.dropdown-list');
  // Loop through the dictionary and add an option element for each key-value pair
  // console.log("count", dropdown.childElementCount);
  if (dropdown.childElementCount === 0) {
    fetchData();
  }
}

window.fetchData = fetchData;

function initDropdown() {
  const drugsList = window.drugsList;
  const dropdown = document.querySelector('.dropdown-list');
  // Loop through the dictionary and add an option element for each key-value pair
  for (let key in window.drugsList) {
    let newListItem = document.createElement('div');
    newListItem.classList.add('dropdown-list-item');
    newListItem.textContent = window.drugsList[key];
    dropdown.appendChild(newListItem);
  }

  // Get the dropdown input and list elements
  const input = document.querySelector('.myInput');
  const list = document.querySelector('.dropdown-list');
  list.style.top = input.offsetTop + input.offsetHeight + 'px';
	list.style.left = input.offsetLeft + 'px';
  list.style.display = 'block';

  // Add a click event listener to the input field
  input.addEventListener('click', function() {
    console.log("Im being clicked");
    // Toggle the visibility of the dropdown list
    list.style.top = input.offsetTop + input.offsetHeight + 'px';
    list.style.left = input.offsetLeft + 'px';
    if (list.style.display === 'block') {
      list.style.display = 'none';
    } else {
      list.style.display = 'block';
    }
  });

// Add a click event listener to each dropdown list item
const items = document.querySelectorAll('.dropdown-list-item');
items.forEach(function(item) {
  item.addEventListener('click', function() {
    // Update the input field with the selected item
    input.value = item.textContent;
    // Trigger an input event on the input field to simulate user input
    const event = new Event('input', {
      bubbles: true,
      cancelable: true,
    });
    input.dispatchEvent(event);
    addTag();
    const event2 = new MouseEvent('click', {
    view: window,
    bubbles: true,
    cancelable: true
  });
  document.dispatchEvent(event2);
  });
});


  // Hide the dropdown list if the user clicks outside of it
  document.addEventListener('click', function(event) {
    console.log('document click');
    if (!input.contains(event.target) && !list.contains(event.target)) {
      console.log('hid dropdown list because you clicked outside!');
      list.style.display = 'none';
    }
  });

  const dropdownSearch = document.querySelector('.myInput');
  const dropdownList = document.querySelector('.dropdown-list');
  const originalDropdownHTML = dropdownList.innerHTML;
  // Add event listener to the search input

  dropdownSearch.addEventListener('input', () => {
    const searchValue = dropdownSearch.value.toLowerCase().trim();
    let found = false;
    // Show/hide options based on search input
    for (let i = 0; i < dropdownList.children.length; i++) {
      const option = dropdownList.children[i];
      const optionText = option.textContent.toLowerCase();

      if (optionText.includes(searchValue)) {
        option.style.display = 'block';
        found = true;
      } else {
        //dropdownList.innerHTML = '<div class="dropdown-list-item">Option not found</div>';
        option.style.display = 'none';

      }
    }
  });

window.selectedOptionIndex = -1; // initialize the selected option index to 0

dropdownSearch.addEventListener('keydown', (event) => {
  console.log('dropdown search key pressed');
  const key = event.key;
  if (key === "ArrowUp" || key === "ArrowDown") {
    event.preventDefault();
    const visibleOptions = Array.from(dropdownList.children).filter((option) => option.style.display !== 'none');
    if (visibleOptions.length > 0) {
      if (window.selectedOptionIndex === -1) {
        window.selectedOptionIndex = key === "ArrowUp" ? visibleOptions.length - 1 : 0;
      } else {
        window.selectedOptionIndex = (window.selectedOptionIndex + (key === "ArrowUp" ? -1 : 1) + visibleOptions.length) % visibleOptions.length;
      }
      visibleOptions.forEach((option, index) => {
        if (index === window.selectedOptionIndex) {
          option.classList.add('selected');
          dropdownSearch.value = option.textContent;
        } else {
          option.classList.remove('selected');
        }
      });
    }
  }
});



  // Show options on click
  dropdownSearch.addEventListener('click', () => {
    console.log("now being clicked");
    dropdownList.classList.toggle('show');
    dropdownSearch.value = '';
    for (let i = 0; i < dropdownList.children.length; i++) {
      const option = dropdownList.children[i];
      option.style.display = 'block';
    }
  });
}

function findInteractions(drugIDs) {
  var interactions = [];
  // Make a POST request to the backend for sending list of drug IDs
  return fetch('/getInteractions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ drugIDs: drugIDs })
  })
  .then(response => response.json())
  .then(data => {
    interactions = data.interactions;
    return interactions;
  })
  .catch(error => console.error(error));
}

async function submitList() {
  var myNodelist = document.getElementById("myUL").childNodes;
    console.log("myNodeList", myNodelist);
  var drugs = [];
  console.log('drugs count', drugs, drugs.length);
  for (var i = 0; i < myNodelist.length; i++) {
    var node = myNodelist[i];
    // console.log("node", node);

    // Check if node has text content
    if (node.textContent.trim().length > 0) {
      // Remove last child if it exists
      if (node.lastChild instanceof Node) {
        node.removeChild(node.lastChild);
      }
      drugs.push(node.innerHTML.trim());
      console.log("node.innerHTML", node.innerHTML);
    }
  }
  // addLoading();
  if (drugs.length == 0 && window.tagsList.length == 0) {
    // alert("Please add at least one drug tag (Press 'Add Tag' or simply click enter)!");
    showError("Please add at least one drug tag (Press 'Add Tag' or simply click enter)!");
  }
  else if (drugs.length == 0 && window.tagsList.length > 0) {
  	showError("Please confirm the drug tags (Press 'Confirm' or simply click shift + enter)!");
  }
  else {
  	hideError();  // Hide error if any
    var count = { "Major": 0, "Moderate": 0, "Minor": 0, "Unknown": 0 };
    drugIDs = []
    for (var i = 0; i < drugs.length; i++) {
      drugIDs.push(window.swappedDrugsList[drugs[i]]);
    }
    var interactions = await findInteractions(drugIDs);
    interactions.sort(function(a, b) {
      var severityOrder = { "Major": 1, "Moderate": 2, "Minor": 3, "Unknown": 4 };
      return severityOrder[a.severity] - severityOrder[b.severity];
    });
    console.log('interactions in submitList', interactions);
    for (var i = 0; i < interactions.length; i++) {
      count[interactions[i]['severity']]++;
    }
    // console.log(count)
    updateTable(interactions);
    addNote(count)
  }
  // May later want to add else if statement to check all interactions for one drug
}

function submitDelay() {
  // Fetch data (pretty large so it takes some time)
  // Call submitList after 2 seconds so that data is recorded
  setTimeout(submitList,2000);
}

function capitalize(str) {
  if (!str) {
    return str;
  }
  const trimmedStr = str.trim().toLowerCase(); // Convert to lowercase
  return trimmedStr.charAt(0).toUpperCase() + trimmedStr.slice(1);
}



document.getElementById("tag-section").innerHTML = "";

// Add a tag when clicking on the "Add" button
function addTag() {
  var inputValue = capitalize(document.getElementById("myInput").value.trim());
  const dropdownList = document.querySelector('.dropdown-list');
  const input = document.querySelector('.myInput');

  if (inputValue === '') {
    //alert("Please enter a drug name!");
    showError("Please enter a drug name!");
  } else if (!window.swappedDrugsList.hasOwnProperty(inputValue)) {
    // alert("Please enter a valid drug name!");
    showError("Please enter a valid drug name!");
  } else if (window.tagsList.includes(inputValue)) {
    // alert("This drug is already added!");
    showError("This drug is already added!");
  } else {
  	hideError();  // Hide error if any
    // Create a new tag element with text and close button
    var tagSection = document.getElementById("tag-section");

	var tag = document.createElement("div");
	tag.classList.add("tag", "badge", "badge-primary", "d-flex", "align-items-center", "justify-content-between", "py-1", "px-2", "ms-10");
	tag.innerHTML = `
	  <span>${inputValue}</span>
	  <button type="button" class="btn-close btn-close-black" aria-label="Close" onclick="deleteTag(this)"></button>
	`;
	tagSection.appendChild(tag);
    window.tagsList.push(inputValue);

	  console.log('tagsList', window.tagsList)
	  document.getElementById("myInput").value = "";  // Clear the input textbox after adding the tag
	  // Trigger an input event on the input field to simulate user input
	  const event = new Event('input', {
		bubbles: true,
		cancelable: true,
	  });
	  input.dispatchEvent(event);
	  dropdownList.style.display = 'block';
	  window.selectedOptionIndex = -1;
  }
}


// Delete a tag when clicking on its delete button
function deleteTag(button) {
  var tag = button.parentElement;
  tag.parentElement.removeChild(tag);
  var tagText = tag.querySelector('span').textContent; // Extract the tag text
  var index = window.tagsList.indexOf(tagText); // Find the index of the tag in the window.tagsList
  if (index !== -1) {
    window.tagsList.splice(index, 1); // Remove the tag from the tagsList
  }
}


</script>
<body>
<h1 class="myheading">My Drug List</h1>


    <main class="container py-3">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-body">
                        <div class="mb-5">
							<div id="tag-section" class="tag-section"></div>
							<input type="text" class="myInput" id="myInput" placeholder="Enter the drug name..." onclick="checkFetch()">
                            <div id="tagButton" onclick="addTag()" class="addBtn">Add Tag</div>
                            <div id="gfg" onclick="newElement()" class="addBtn">Confirm</div>
                            <div onclick="reset()" class="addBtn">Reset List</div>
                            <div class="dropdown-list"></div>
                        </div>
                    </div>
                </div>
				<div id="error-label" class="alert alert-danger animate__animated animate__fadeIn d-none"></div>
            </div>
        </div>
      <script>
        let btn = document.getElementById('gfg');
        document.addEventListener('keypress', (event)=>{

        // event.keyCode or event.which  property will have the code of the pressed key
        let keyCode = event.keyCode ? event.keyCode : event.which;

        // 13 points the enter key
        if(event.shiftKey && event.keyCode === 13) {
        // call click function of the buttonn
            btn.click();
        }
        });
        let tagbtn = document.getElementById('tagButton');
        document.addEventListener('keydown', function(event) {
        if (event.keyCode === 13 && !event.shiftKey) {
            tagbtn.click();
        }
      });
    </script>

    <ul id="myUL" class="list-group"></ul>

        <button id="mybtn" onclick="submitDelay()" class="submitBtn">Submit</button>

        <div class="table-responsive">
            <table id="drugtable" class="table table-striped table-bordered text-center">
                <thead class="text-white"></thead>
                <tbody>
                    <!-- Rows will be added dynamically by the JavaScript code -->
                </tbody>
            </table>
        </div>
        <div id="notediv" class="card mt-3">
        </div>
    </main>
    <script>
      import myLoader from "Server/working/static/js/myLoader.js";
      const [isLoading, setIsLoading] = useState(false);
    </script>
</body>
<footer id="footer" class="footer fixed-bottom bg-light">
  <div class="container d-flex justify-content-center">

    <div class="row">
      <div class="col text-center">
        <span>&copy; Copyright
          <strong>Tavlabs</strong>. All Rights Reserved</span>
      </div>
    </div>
	    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up"></i></a>
  </div>
</footer>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-QC/EnoYMSNN7yb2KNx2U5r6u/cxqD+"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-h8X9FYbyyh/p1+Jt1bwEpp+fVAInrzJf+YzqG+zshEldW8xsr+Fd4y05f4Fb5mh5" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-5fiJTETJOFw2M0ZZULzqOylXjsN0zVg/Nvqt1qrE/8DfhZHTtWWw3fBkCjlLx1qX" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.js"></script>

<!-- Vendor JS Files -->
  <script src="static/bootstrap/js/bootstrap.bundle.js" type="text/javascript"></script>
  <script src="static/quill/quill.min.js" type="text/javascript"></script>
  <script src="static/tinymce/tinymce.min.js" type="text/javascript"></script>
  <script src="static/simple-datatables/simple-datatables.js" type="text/javascript"></script>
  <script src="static/chart.js/chart.min.js" type="text/javascript"></script>
  <script src="static/apexcharts/apexcharts.min.js" type="text/javascript"></script>
  <script src="static/echarts/echarts.min.js" type="text/javascript"></script>

  <!-- Template Main JS File -->
  <script src="static/js/jquery.min.js" type="text/javascript"></script>
  <script src="static/js/popper.js" type="text/javascript"></script>
  <script src="static/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="static/js/main_new.js" type="text/javascript"></script>
  <script src="static/js/main.js" type="text/javascript"></script>



</html>